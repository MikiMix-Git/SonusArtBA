<!DOCTYPE html>
<html lang="hr">
<head>
<meta charset="UTF-8">
<title>Argon & Marantz Katalog - Svi podaci</title>
<style>
/* (postojeći CSS, ostavljen bez izmene) */
</style>
</head>
<body>

<header>
  <h1>Argon & Marantz – Katalog proizvoda 
    <span id="version-badge" style="font-size:.75em; background:#222; color:#fff; padding:.2em .5em; border-radius:4px;">v0.44.7</span>
  </h1>
</header>

<div class="sticky-bar">
  <nav id="category-nav"></nav>
  <div class="filters">
    <!-- (filteri ostaju isti) -->
  </div>
</div>

<div class="catalog-header" id="catalog-count"></div>
<section class="catalog" id="product-list"></section>

<!-- Fullscreen Image Modal -->
<div id="fullscreen-modal" style="display: none;">
  <span id="modal-close-btn">&times;</span>
  <img id="modal-image" src="" alt="Slika proizvoda u punoj veličini">
  <button id="modal-prev-btn" style="display: none;">‹</button>
  <button id="modal-next-btn" style="display: none;">›</button>
</div>

<script>
// Globalne promenljive za kontrolu galerije
let globalImageUrls = [];
let globalImageIndex = 0;
let globalMainImage = null;
let globalThumbs = [];

function openGallery(imageUrls, startIndex, mainImage, thumbs) {
  globalImageUrls = imageUrls;
  globalImageIndex = startIndex;
  globalMainImage = mainImage;
  globalThumbs = thumbs;
  updateGalleryImage();
}

function updateGalleryImage() {
  if (!globalMainImage) return;
  globalMainImage.src = globalImageUrls[globalImageIndex];
  if (globalThumbs.length) {
    globalThumbs.forEach((t,i)=> t.classList.toggle("active", i===globalImageIndex));
  }
}

function prevGalleryImage() {
  globalImageIndex = (globalImageIndex-1+globalImageUrls.length)%globalImageUrls.length;
  updateGalleryImage();
}
function nextGalleryImage() {
  globalImageIndex = (globalImageIndex+1)%globalImageUrls.length;
  updateGalleryImage();
}

function renderList(items) {
  const list = document.getElementById("product-list");
  list.innerHTML = "";
  document.getElementById("catalog-count").textContent = 
    `${currentBrand === "ALL" ? "Svi brendovi" : currentBrand} – ${currentCategory === "ALL" ? "sve kategorije" : currentCategory} – ${items.length} artikala`;

  items.forEach((prod, index) => {
    const card = document.createElement("div");
    card.className = "product-card";
    const cardId = `card-${index}`;

    const processedKeys = new Set(['slika_url','image','images','naziv','name','opis','tagline','description','cijena','price','eur_price','link','specifications','features','badge-ovi','bedz','brend','id','categories','specifikacije','boje','images_urls','variants','brand_logo']);
    let cardContent = '';

    const imageUrls = (prod.images_urls || []).filter(Boolean);
    const mainImageUrl = imageUrls[0] || 'https://placehold.co/300x200/cccccc/000000?text=Bez+slike';

    cardContent += `<div class="image-gallery" id="gallery-${cardId}">`;
    cardContent += `<div class="main-image-container">`;
    cardContent += `<img src="${mainImageUrl}" alt="Slika za ${prod.naziv || prod.name}" class="main-image">`;
    if (imageUrls.length > 1) {
      cardContent += `<button class="gallery-nav-btn prev">‹</button>`;
      cardContent += `<button class="gallery-nav-btn next">›</button>`;
      cardContent += `</div>`;
      cardContent += `<div class="thumbnails">`;
      imageUrls.forEach((url, i) => {
        cardContent += `<img src="${url}" alt="Sličica ${i+1}" class="thumbnail ${i === 0 ? 'active' : ''}" data-index="${i}">`;
      });
      cardContent += `</div>`;
    } else {
      cardContent += `</div>`;
    }
    cardContent += `</div>`;

    if (prod.brand_logo) {
      const invertClass = (prod.brend === 'Argon') ? 'invert-logo' : '';
      cardContent += `<img src="${prod.brand_logo}" alt="${prod.brend || 'Brand'} Logo" class="brand-logo ${invertClass}">`;
    }

    const rating = getRatingFromBadges(prod);
    cardContent += `<h3>${prod.naziv || prod.name || 'Nepoznat naziv'}${renderStars(rating)}</h3>`;

    cardContent += `<p>${prod.opis || prod.tagline || prod.description || ''}</p>`;

    if ((prod.eur_price||0) > 0) {
      cardContent += `<p><strong>Cijena:</strong> <span class="product-price" data-eur-price="${prod.eur_price}"></span></p>`;
    } else {
      cardContent += `<p><strong>Cijena:</strong> -</p>`;
    }

    // Karakteristike
    if (prod.features && prod.features.length > 0) {
      const filtered = prod.features.filter(f => !( /^\d+(\.\d+)?$/.test(typeof f==='object'?f.title:f) ));
      if (filtered.length>0) {
        const featuresId = `features-${cardId}`;
        cardContent += `<h4 data-toggle="${featuresId}">Karakteristike</h4><div id="${featuresId}" class="collapsible-content"><ul class="features-list">`;
        filtered.forEach(f=>{
          if (typeof f === 'object' && f.title) {
            cardContent += `<li><strong>${f.title}:</strong> ${f.description}</li>`;
          } else {
            cardContent += `<li>${f}</li>`;
          }
        });
        cardContent += `</ul></div>`;
      }
    }

    // Specifikacije
    if (prod.specifications) {
      const specId = `specs-${cardId}`;
      cardContent += `<h4 data-toggle="${specId}">Specifikacije</h4><div id="${specId}" class="collapsible-content"><dl class="specs-list">`;
      for (const k in prod.specifications) {
        cardContent += `<dt>${k}</dt><dd>${prod.specifications[k]}</dd>`;
      }
      cardContent += `</dl></div>`;
    }

    // Ostali podaci
    let otherContent = '<dl class="specs-list">'; let hasOther=false;
    for (const key in prod) {
      if (!processedKeys.has(key)) { hasOther=true; otherContent+=`<dt>${key}</dt><dd>${prod[key]}</dd>`; }
    }
    otherContent+='</dl>';
    if (hasOther) cardContent+=`<h4 data-toggle="other-${cardId}">Ostali podaci</h4><div id="other-${cardId}" class="collapsible-content">${otherContent}</div>`;

    if (prod.link) cardContent+=`<a href="${prod.link}" target="_blank" class="link-button">Pogledaj ${prod.brend}</a>`;

    card.innerHTML=cardContent;
    list.appendChild(card);

    // Event listeneri
    card.querySelectorAll("h4[data-toggle]").forEach(h4=>{
      h4.addEventListener("click",()=>{
        h4.classList.toggle("expanded");
        document.getElementById(h4.dataset.toggle).classList.toggle("expanded");
      });
    });

    const mainImage = card.querySelector(".main-image");
    const thumbs = [...card.querySelectorAll(".thumbnail")];
    if (mainImage) {
      mainImage.addEventListener("click",()=>openFullscreenImage(imageUrls,0));
      if (imageUrls.length>1) {
        card.querySelector(".prev")?.addEventListener("click",()=>{openGallery(imageUrls,(globalImageIndex-1+imageUrls.length)%imageUrls.length,mainImage,thumbs);});
        card.querySelector(".next")?.addEventListener("click",()=>{openGallery(imageUrls,(globalImageIndex+1)%imageUrls.length,mainImage,thumbs);});
      }
      thumbs.forEach(t=>{
        t.addEventListener("click",()=>{
          openGallery(imageUrls,parseInt(t.dataset.index),mainImage,thumbs);
        });
      });
    }
  });
}

</script>

</body>
</html>
