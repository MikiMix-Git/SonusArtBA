<!DOCTYPE html>
<html lang="sr">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>Audio Katalog – v1.3.5</title>
    <style>
        :root { --primary: #1a1a1a; --secondary: #2c3e50; --accent: #e74c3c; --light: #ecf0f1; --border: #ddd; --radius: 12px; --shadow: 0 4px 12px rgba(0,0,0,0.1); }
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; }
        body { background: #f5f7fa; color: var(--primary); line-height: 1.6; }
        header { background: var(--primary); color: white; padding: 1.5rem 0; text-align: center; box-shadow: var(--shadow); }
        header h1 { font-size: 2rem; margin-bottom: 0.5rem; }
        .subtitle { font-size: 1rem; opacity: 0.9; }
        .controls { max-width: 1200px; margin: 2rem auto; padding: 0 1rem; display: flex; flex-wrap: wrap; gap: 1rem; align-items: center; }
        .search-box, .filter-select { padding: 0.75rem 1rem; border: 1px solid var(--border); border-radius: var(--radius); font-size: 1rem; flex: 1; min-width: 200px; }
        .search-box:focus, .filter-select:focus { outline: none; border-color: var(--accent); box-shadow: 0 0 0 3px rgba(231,76,60,0.2); }
        .stats { font-size: 0.9rem; color: #666; margin-left: auto; }
        .container { max-width: 1200px; margin: 0 auto; padding: 0 1rem; }
        .grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap: 1.5rem; margin-top: 1rem; }
        .card { background: white; border-radius: var(--radius); overflow: hidden; box-shadow: var(--shadow); transition: all 0.3s ease; cursor: pointer; position: relative; }
        .card:hover { transform: translateY(-8px); box-shadow: 0 12px 24px rgba(0,0,0,0.15); }
        .card-img { height: 220px; background: #fff; position: relative; overflow: hidden; }
        .card-img img.product { width: 100%; height: 100%; object-fit: contain; transition: transform 0.3s ease; }
        .card:hover .card-img img.product { transform: scale(1.05); }
        .brand-logo-container {
            position: absolute; top: 10px; left: 10px; z-index: 3; background: rgba(255,255,255,0.95);
            padding: 6px; border-radius: 10px; box-shadow: 0 2px 10px rgba(0,0,0,0.2); width: 50px; height: 50px;
            display: flex; align-items: center; justify-content: center; font-weight: bold; font-size: 0.7rem; text-align: center;
        }
        .brand-logo-container img { width: 40px; height: 40px; object-fit: contain; }
        .brand-logo-container img.force-dark { filter: invert(1) hue-rotate(180deg) brightness(0.9) !important; }
        .card-body { padding: 1rem; flex-grow: 1; display: flex; flex-direction: column; }
        .card-title { font-size: 1.1rem; font-weight: 600; margin-bottom: 0.5rem; color: var(--secondary); display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden; }
        .card-price { font-size: 1.3rem; font-weight: 700; color: var(--accent); margin: 0.5rem 0; }
        .card-sku { font-size: 0.85rem; color: #777; margin-bottom: 0.5rem; }
        .card-category { font-size: 0.85rem; color: var(--accent); font-weight: 500; margin-bottom: 0.5rem; text-transform: capitalize; }
        .colors { display: flex; gap: 6px; flex-wrap: wrap; margin-top: auto; padding-top: 0.75rem; }
        .color-swatch { width: 24px; height: 24px; border-radius: 50%; border: 2px solid white; box-shadow: 0 0 0 1px #ccc; overflow: hidden; }
        .color-swatch img { width: 100%; height: 100%; object-fit: cover; }
        .color-swatch.hex { background: var(--swatch-color); }
        .modal { display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.85); z-index: 1000; overflow-y: auto; align-items: center; justify-content: center; }
        .modal.active { display: flex; }
        .modal-content { background: white; border-radius: var(--radius); max-width: 900px; width: 95%; max-height: 95vh; overflow-y: auto; position: relative; }
        .modal-close { position: absolute; top: 10px; right: 15px; background: none; border: none; font-size: 2rem; cursor: pointer; color: #aaa; z-index: 10; }
        .modal-close:hover { color: var(--accent); }
        .modal-header { padding: 1.5rem; background: var(--primary); color: white; border-radius: var(--radius) var(--radius) 0 0; }
        .modal-title { font-size: 1.8rem; margin-bottom: 0.5rem; }
        .modal-brand { font-size: 1rem; opacity: 0.9; }
        .modal-body { padding: 2rem; }
        .gallery { display: flex; flex-wrap: wrap; gap: 10px; margin-bottom: 2rem; justify-content: center; }
        .gallery img { max-width: 200px; max-height: 200px; object-fit: contain; cursor: pointer; border: 2px solid transparent; border-radius: 8px; }
        .gallery img:hover { border-color: var(--accent); }
        .modal-info { display: grid; grid-template-columns: 1fr 1fr; gap: 2rem; }
        .modal-desc { grid-column: span 2; margin-bottom: 1.5rem; line-height: 1.8; }
        .specs-table { width: 100%; border-collapse: collapse; }
        .specs-table th, .specs-table td { padding: 0.75rem; text-align: left; border-bottom: 1px solid #eee; }
        .specs-table th { background: #f9f9f9; width: 40%; }
        .colors-big { display: flex; gap: 12px; flex-wrap: wrap; margin: 1rem 0; }
        .colors-big .color-swatch { width: 40px; height: 40px; }
        .modal-footer { padding: 1.5rem; text-align: center; background: #f9f9f9; border-top: 1px solid var(--border); }
        .btn { padding: 0.75rem 1.5rem; background: var(--accent); color: white; border: none; border-radius: var(--radius); cursor: pointer; font-size: 1rem; }
        .btn:hover { background: #c0392b; }
        .loading, .no-results { text-align: center; padding: 3rem 1rem; color: #777; font-size: 1.1rem; }
        .footer { text-align: center; padding: 2rem 1rem; color: #777; font-size: 0.9rem; margin-top: 3rem; border-top: 1px solid var(--border); }
        @media (max-width: 768px) { .modal-info { grid-template-columns: 1fr; } .controls { flex-direction: column; } .stats { margin-left: 0; } }
    </style>
</head>
<body>
    <header>
        <h1>Audio Katalog</h1>
        <p class="subtitle">Live sa GitHub-a – v1.3.5 (uvek prva slika na kartici)</p>
    </header>

    <div class="controls">
        <input type="text" class="search-box" placeholder="Pretraži po imenu..." id="searchInput" />
        <select class="filter-select" id="brandFilter"><option value="">Svi brendovi</option></select>
        <select class="filter-select" id="categoryFilter"><option value="">Sve kategorije</option></select>
        <div class="stats" id="stats">Učitavanje...</div>
    </div>

    <div class="container">
        <div id="loading" class="loading">Učitavanje sa GitHub-a...</div>
        <div id="grid" class="grid" style="display:none;"></div>
        <div id="noResults" class="no-results" style="display:none;">Nema rezultata.</div>
    </div>

    <div id="modal" class="modal">
        <div class="modal-content">
            <button class="modal-close" id="modalClose">×</button>
            <div class="modal-header">
                <div class="modal-title" id="modalTitle"></div>
                <div class="modal-brand" id="modalBrand"></div>
            </div>
            <div class="modal-body">
                <div class="gallery" id="modalGallery"></div>
                <div class="modal-info">
                    <div class="modal-desc" id="modalDesc"></div>
                    <div>
                        <p><strong>SKU:</strong> <span id="modalSKU"></span></p>
                        <p><strong>Cena:</strong> <span id="modalPrice"></span></p>
                        <p><strong>Kategorija:</strong> <span id="modalCategory"></span></p>
                        <p id="taglineSection"><strong>Tagline:</strong> <span id="modalTagline"></span></p>
                    </div>
                </div>
                <div class="colors-big" id="modalColors"></div>
                <table class="specs-table" id="modalSpecs"></table>
            </div>
            <div class="modal-footer">
                <button class="btn" id="modalLink">Idi na originalnu stranicu</button>
            </div>
        </div>
    </div>

    <footer class="footer">
        <p>web_app_v1.3.5.html – Na kartici uvek prva slika</p>
    </footer>

    <script>
        const GITHUB_RAW_BASE = "https://raw.githubusercontent.com/MikiMix-Git/SonusArtBA/f0561b6b2f32ad28e0cb25e761e52acc57743370/json";
        const jsonFiles = [
            `${GITHUB_RAW_BASE}/argon_audio_products_all_categories.json`,
            `${GITHUB_RAW_BASE}/bowers_wilkins_products.json`,
            `${GITHUB_RAW_BASE}/denon_products.json`,
            `${GITHUB_RAW_BASE}/dynaudio_products.json`,
            `${GITHUB_RAW_BASE}/marantz_all_products.json`,
            `${GITHUB_RAW_BASE}/qacoustics_products.json`
        ];

        let allProducts = [], brands = new Set(), categories = new Set();
        const grid = document.getElementById('grid');
        const loading = document.getElementById('loading');
        const noResults = document.getElementById('noResults');
        const searchInput = document.getElementById('searchInput');
        const brandFilter = document.getElementById('brandFilter');
        const categoryFilter = document.getElementById('categoryFilter');
        const stats = document.getElementById('stats');

        const modal = document.getElementById('modal');
        const modalClose = document.getElementById('modalClose');
        const modalTitle = document.getElementById('modalTitle');
        const modalBrand = document.getElementById('modalBrand');
        const modalGallery = document.getElementById('modalGallery');
        const modalDesc = document.getElementById('modalDesc');
        const modalSKU = document.getElementById('modalSKU');
        const modalPrice = document.getElementById('modalPrice');
        const modalCategory = document.getElementById('modalCategory');
        const modalTagline = document.getElementById('modalTagline');
        const taglineSection = document.getElementById('taglineSection');
        const modalColors = document.getElementById('modalColors');
        const modalSpecs = document.getElementById('modalSpecs');
        const modalLink = document.getElementById('modalLink');
        const fallback = 'data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 400 300%22><rect width=%22400%22 height=%22300%22 fill=%22%23f0f0f0%22/><text x=%22200%22 y=%22150%22 font-size=%2230%22 text-anchor=%22middle%22 fill=%22%23999%22>No Image</text></svg>';

        function detectBrandFromFilename(url) {
            if (url.includes('argon')) return 'Argon Audio';
            if (url.includes('bowers')) return 'Bowers & Wilkins';
            if (url.includes('denon')) return 'Denon';
            if (url.includes('dynaudio')) return 'Dynaudio';
            if (url.includes('marantz')) return 'Marantz';
            if (url.includes('qacoustics')) return 'Q Acoustics';
            return null;
        }

        function getBrandDisplay(p, sourceUrl = '') {
            const logo = p.brend_logo_url || '';
            const map = { 'qacoustics': 'Q Acoustics', 'dynaudio': 'Dynaudio', 'marantz': 'Marantz', 'denon': 'Denon', 'bowers': 'Bowers & Wilkins', 'argon': 'Argon Audio' };
            for (const key in map) if (logo.includes(key)) return { name: map[key], url: logo };
            const fallback = detectBrandFromFilename(sourceUrl || '');
            return { name: fallback || 'Audio', url: logo || null };
        }

        async function loadJsonFiles() {
            const promises = jsonFiles.map(async (url) => {
                const data = await fetch(url).then(r => r.ok ? r.json() : []).catch(() => []);
                data.forEach(p => p._sourceUrl = url);
                return data;
            });
            const results = await Promise.all(promises);
            allProducts = results.flat();

            allProducts.forEach(p => {
                const brand = getBrandDisplay(p, p._sourceUrl).name;
                brands.add(brand);
                if (p.kategorije) categories.add(p.kategorije);
            });

            populateFilters();
            renderProducts();
            loading.style.display = 'none';
            grid.style.display = 'grid';
        }

        function populateFilters() {
            [...brands].sort().forEach(b => { const o = document.createElement('option'); o.value = b; o.textContent = b; brandFilter.appendChild(o); });
            [...categories].sort().forEach(c => { const o = document.createElement('option'); o.value = c; o.textContent = c; categoryFilter.appendChild(o); });
        }

        function getFilteredProducts() {
            const q = searchInput.value.toLowerCase().trim();
            const b = brandFilter.value;
            const c = categoryFilter.value;
            return allProducts.filter(p => {
                const ms = !q || (p.ime_proizvoda && p.ime_proizvoda.toLowerCase().includes(q));
                const mb = !b || getBrandDisplay(p, p._sourceUrl).name === b;
                const mc = !c || p.kategorije === c;
                return ms && mb && mc;
            });
        }

        function renderProducts() {
            const filtered = getFilteredProducts();
            grid.innerHTML = '';
            if (!filtered.length) { noResults.style.display = 'block'; stats.textContent = '0 proizvoda'; return; }
            noResults.style.display = 'none';
            stats.textContent = `${filtered.length} od ${allProducts.length} proizvoda`;

            filtered.forEach(p => {
                const card = document.createElement('div');
                card.className = 'card';
                const brandInfo = getBrandDisplay(p, p._sourceUrl);

                // UVEK PRVA SLIKA (images[0])
                const mainImg = (p.url_slika && p.url_slika.length > 0) ? p.url_slika[0] : fallback;

                const logoContainer = document.createElement('div');
                logoContainer.className = 'brand-logo-container';

                if (brandInfo.url) {
                    const logoImg = document.createElement('img');
                    logoImg.src = brandInfo.url;
                    logoImg.alt = brandInfo.name;
                    if (brandInfo.name === 'Argon Audio' || brandInfo.name === 'Denon') {
                        logoImg.classList.add('force-dark');
                    }
                    logoImg.onerror = () => logoContainer.textContent = brandInfo.name;
                    logoContainer.appendChild(logoImg);
                } else {
                    logoContainer.textContent = brandInfo.name;
                }

                const colorsHtml = (p.dodatne_informacije?.dostupne_boje || []).slice(0,5).map(c => {
                    if (c.url_uzorka?.startsWith('http')) return `<div class="color-swatch"><img src="${c.url_uzorka}" onerror="this.style.display='none'"/></div>`;
                    if (c.url_uzorka?.startsWith('#')) return `<div class="color-swatch hex" style="--swatch-color:${c.url_uzorka};"></div>`;
                    return `<div class="color-swatch" style="background:#ccc;"></div>`;
                }).join('');

                card.innerHTML = `
                    <div class="card-img">
                        <img src="${mainImg}" alt="${p.ime_proizvoda}" class="product" onerror="this.src='${fallback}'"/>
                    </div>
                    <div class="card-body">
                        <div class="card-category">${p.kategorije || 'N/A'}</div>
                        <div class="card-title">${p.ime_proizvoda || 'Nema imena'}</div>
                        <div class="card-sku">SKU: ${p.sku || 'N/A'}</div>
                        <div class="card-price">${p.cena || 'Cena nedostupna'}</div>
                        <div class="colors">${colorsHtml}</div>
                    </div>
                `;
                card.querySelector('.card-img').prepend(logoContainer);
                card.onclick = () => openModal(p);
                grid.appendChild(card);
            });
        }

        // openModal i ostali delovi ostaju identični v1.3.4 – nisu promenjeni
        function openModal(p) {
            modalTitle.textContent = p.ime_proizvoda || 'Nema imena';
            modalBrand.textContent = getBrandDisplay(p, p._sourceUrl).name;
            modalSKU.textContent = p.sku || 'N/A';
            modalPrice.textContent = p.cena || 'Cena nedostupna';
            modalCategory.textContent = p.kategorije || 'N/A';
            modalDesc.innerHTML = p.opis ? p.opis.replace(/\n/g, '<br>') : 'Opis nije dostupan';
            const tagline = p.dodatne_informacije?.tagline;
            tagline && tagline !== 'Tagline nedostupan' ? (modalTagline.textContent = tagline, taglineSection.style.display = 'block') : taglineSection.style.display = 'none';

            modalGallery.innerHTML = '';
            (p.url_slika || []).forEach(src => {
                const img = document.createElement('img');
                img.src = src;
                img.onerror = () => img.src = fallback;
                img.onclick = () => window.open(src, '_blank');
                modalGallery.appendChild(img);
            });

            modalColors.innerHTML = '';
            (p.dodatne_informacije?.dostupne_boje || []).forEach(c => {
                const div = document.createElement('div');
                div.className = 'color-swatch';
                if (c.url_uzorka?.startsWith('http')) {
                    const i = document.createElement('img');
                    i.src = c.url_uzorka;
                    div.appendChild(i);
                } else if (c.url_uzorka?.startsWith('#')) {
                    div.classList.add('hex');
                    div.style.setProperty('--swatch-color', c.url_uzorka);
                }
                modalColors.appendChild(div);
            });

            modalSpecs.innerHTML = '';
            const specs = p.specifikacije || {};
            if (Object.keys(specs).length === 0) {
                modalSpecs.innerHTML = '<tr><td colspan="2">Nema specifikacija</td></tr>';
            } else {
                Object.entries(specs).forEach(([k, v]) => {
                    const tr = document.createElement('tr');
                    tr.innerHTML = `<th>${k}</th><td>${v}</td>`;
                    modalSpecs.appendChild(tr);
                });
            }

            modalLink.onclick = () => window.open(p.url_proizvoda, '_blank');
            modal.classList.add('active');
        }

        modalClose.onclick = () => modal.classList.remove('active');
        modal.onclick = e => { if (e.target === modal) modal.classList.remove('active'); };
        searchInput.addEventListener('input', renderProducts);
        brandFilter.addEventListener('change', renderProducts);
        categoryFilter.addEventListener('change', renderProducts);

        loadJsonFiles().catch(err => {
            loading.innerHTML = `<p style="color:red;">Greška: ${err.message}</p>`;
        });
    </script>
</body>
</html>
