<!DOCTYPE html>
<!--
CHANGELOG
v0.15.1 (2025-08-13)
- Ispravljeno: Ključevi 'id' i 'categories' se više ne prikazuju u sekciji "Ostali podaci".
-->
<html lang="hr">
<head>
<meta charset="UTF-8">
<title>Argon & Marantz Katalog - Svi podaci</title>
<style>
:root {
  --bg:#f4f4f4; --ink:#222; --ink-soft:#444; --ink-muted:#666; --card:#fff;
  --accent:#007acc; --accent-hover:#005c99; --ok:#155724; --ok-bg:#d4edda;
  --bad:#721c24; --bad-bg:#f8d7da; --line:#ccc; --soft:#eee;
}
* { box-sizing: border-box; }
body { font-family: Arial, sans-serif; background: var(--bg); margin: 0; color: var(--ink); }
header { background: var(--ink); color: #fff; padding: 1rem; text-align: center; }
.sticky-bar { position: sticky; top: 0; z-index: 10; }
nav, .filters { background: var(--ink-soft); padding: 0.5rem; display: flex; gap: 0.5rem; flex-wrap: wrap; }
nav button, .filters input, .filters select, .filters button { padding: 0.5rem; border-radius: 4px; border: none; }
nav button { background: var(--ink-muted); color: white; cursor: pointer; }
nav button.active { background: var(--accent); }
nav button:hover { background: #999; }
.filters input[type="number"] { width: 90px; }
.filters button { background: var(--accent); color: #fff; cursor: pointer; }
.filters button:hover { background: var(--accent-hover); }
.catalog-header { padding: 0.5rem 1rem; font-weight: bold; background: var(--soft); }
.catalog { display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 1rem; padding: 1rem; }
.product-card { background: var(--card); border-radius: 6px; padding: 1rem; box-shadow: 0 2px 4px rgba(0,0,0,0.1); display: flex; flex-direction: column; }
.product-card img { max-width: 100%; height: auto; border-radius: 4px; background: #fafafa; object-fit: cover; margin-bottom: 1rem; }
.product-card h3 { margin: 0.6rem 0 0.2rem; font-size: 1.1rem; }
.product-card p { margin: 0.2rem 0; }
.product-card h4 {
    margin-top: 1.2rem;
    margin-bottom: 0.5rem;
    border-bottom: 1px solid var(--line);
    padding-bottom: 0.3rem;
    font-size: 0.9rem;
    text-transform: uppercase;
    color: var(--ink-soft);
}
.link-button {
  display: inline-block;
  background: var(--accent);
  color: #fff;
  padding: 0.6rem 1rem;
  text-decoration: none;
  border-radius: 4px;
  text-align: center;
  margin-top: 0.8rem;
  transition: background-color 0.2s;
  width: 100%;
}
.link-button:hover { background: var(--accent-hover); }
.features-list, .specs-list { padding-left: 0; list-style: none; }
.features-list li { margin-bottom: 0.5rem; }
.specs-list dt { font-weight: bold; color: var(--ink-muted); margin-top: 0.6rem; }
.specs-list dd { margin-left: 1em; margin-bottom: 0.2rem; word-wrap: break-word; }
.specs pre { white-space: pre-wrap; word-break: break-all; background: #f0f0f0; padding: 5px; border-radius: 3px; font-size: 0.9em; }
@media (max-width: 600px) {
  .filters { flex-direction: column; }
  nav { flex-direction: column; }
}
</style>
</head>
<body>

<header>
  <h1>Argon & Marantz – Katalog proizvoda 
    <span id="version-badge" style="font-size:.75em; background:#222; color:#fff; padding:.2em .5em; border-radius:4px;">v0.15.1</span>
  </h1>
</header>

<div class="sticky-bar">
  <nav id="category-nav"></nav>
  <div class="filters">
    <select id="brand-filter">
      <option value="ALL">Svi brendovi</option>
      <option value="Argon">Argon</option>
      <option value="Marantz">Marantz</option>
    </select>
    <input type="text" id="search" placeholder="Pretraga po nazivu...">
    <input type="number" id="min-price" placeholder="Min €">
    <input type="number" id="max-price" placeholder="Max €">
    <select id="feature-filter">
      <option value="">Sve karakteristike</option>
      <option value="Bluetooth">Bluetooth</option>
      <option value="Wi-Fi">Wi‑Fi</option>
      <option value="HDMI ARC">HDMI ARC</option>
      <option value="ANC">ANC</option>
    </select>
    <select id="sort-select">
      <option value="">Bez sortiranja</option>
      <option value="price-asc">Cijena ↑</option>
      <option value="price-desc">Cijena ↓</option>
      <option value="rating-desc">Ocjena ↓</option>
      <option value="rating-asc">Ocjena ↑</option>
    </select>
    <label><input type="checkbox" id="only-priced"> Samo sa cijenom</label>
    <button id="apply-btn">Primijeni filtere</button>
  </div>
</div>

<div class="catalog-header" id="catalog-count"></div>
<section class="catalog" id="product-list"></section>

<script>
const APP_VERSION = "0.15.1";
const RAW_ARGON = "https://raw.githubusercontent.com/MikiMix-Git/SonusArtBA/main/json/argon_audio_products_all_categories.json";
const RAW_MARANTZ = "https://raw.githubusercontent.com/MikiMix-Git/SonusArtBA/refs/heads/main/json/marantz_all_products.json";
let allProducts = {};
let allItemsFlat = [];
let currentBrand = "ALL";
let currentCategory = "ALL";

function normalizePrice(val) {
  if (typeof val !== "string") return Number(val) || 0;
  const compact = val.replace(/\s/g, "");
  const match = compact.match(/(\d+[.,]?\d*)/g);
  if (!match) return 0;
  let s = match[match.length - 1];
  if (s.includes(".") && s.includes(",")) s = s.replace(/\./g, "").replace(",", ".");
  else if (s.includes(",")) s = s.replace(",", ".");
  return parseFloat(s) || 0;
}
function getRatingFromBadges(prod) {
  const badges = prod["badge-ovi"] || prod["bedz"] || prod["features"] || [];
  const ratingBadge = badges.find(b => {
      const val = typeof b === 'object' ? b.title : b;
      return /^\d+(\.\d+)?$/.test(String(val).trim());
  });
  if (ratingBadge) {
      const val = typeof ratingBadge === 'object' ? ratingBadge.title : ratingBadge;
      return parseFloat(val);
  }
  return 0;
}
function dedupProducts(items) {
  const map = new Map();
  items.forEach(p => {
    const key = `${p.naziv || p.name || ""}|${p.link || ""}`;
    if (!map.has(key)) map.set(key, p);
  });
  return Array.from(map.values());
}

Promise.all([
  fetch(RAW_ARGON).then(r => r.json()),
  fetch(RAW_MARANTZ).then(r => r.json())
]).then(([argonData, marantzData]) => {
  allProducts = {
    Argon: argonData,
    Marantz: marantzData
  };

  const processedMarantz = marantzData.map(p => {
    let imageUrl = p.image;
    if (imageUrl && imageUrl.startsWith('https://www.marantz.comhttps://www.marantz.com')) {
        imageUrl = imageUrl.replace('https://www.marantz.comhttps://www.marantz.com', 'https://www.marantz.com');
    }
    return {
      ...p,
      brend: "Marantz",
      naziv: p.name,
      cijena: p.price,
      opis: p.tagline,
      slika_url: (imageUrl && imageUrl.trim() !== '') ? imageUrl : null,
    };
  });
  
  allItemsFlat = dedupProducts([
    ...Object.values(argonData).flat().map(p => ({ ...p, brend: "Argon" })),
    ...processedMarantz
  ]);

  renderCategoriesForBrand("ALL");
  highlightActiveCategory();
  applyFilters();
  document.getElementById("version-badge").textContent = `v${APP_VERSION}`;
  document.title = `Katalog v${APP_VERSION}`;
});

function renderCategoriesForBrand(brand) {
    const nav = document.getElementById("category-nav");
    nav.innerHTML = "";
    let categories = ["ALL"];
    if (brand === "Argon") {
        categories = ["ALL", ...Object.keys(allProducts.Argon)];
    }
    categories.forEach(cat => {
        const btn = document.createElement("button");
        btn.textContent = cat === "ALL" ? `Sve kategorije` : cat;
        btn.dataset.cat = cat;
        btn.onclick = () => {
            currentCategory = cat;
            highlightActiveCategory();
            applyFilters();
        };
        nav.appendChild(btn);
    });
}

function highlightActiveCategory() {
  document.querySelectorAll("#category-nav button")
    .forEach(b => b.classList.toggle("active", b.dataset.cat === currentCategory));
}

function sourceItems() {
  const brand = currentBrand;
  const cat = currentCategory;
  if (brand === "ALL") {
    return allItemsFlat;
  }
  if (brand === "Argon") {
    if (cat === "ALL") {
      return Object.values(allProducts.Argon).flat().map(p => ({ ...p, brend: "Argon" }));
    }
    return (allProducts.Argon?.[cat] || []).map(p => ({ ...p, brend: "Argon" }));
  }
  if (brand === "Marantz") {
    return allProducts.Marantz.map(p => {
      let imageUrl = p.image;
      if (imageUrl && imageUrl.startsWith('https://www.marantz.comhttps://www.marantz.com')) {
          imageUrl = imageUrl.replace('https://www.marantz.comhttps://www.marantz.com', 'https://www.marantz.com');
      }
      return {
        ...p,
        brend: "Marantz",
        naziv: p.name,
        cijena: p.price,
        opis: p.tagline,
        slika_url: (imageUrl && imageUrl.trim() !== '') ? imageUrl : null,
      };
    });
  }
  return [];
}
function applySort(items) {
  switch (document.getElementById("sort-select").value) {
    case "price-asc":  return items.slice().sort((a,b)=> normalizePrice(a.cijena || a.price) - normalizePrice(b.cijena || b.price));
    case "price-desc": return items.slice().sort((a,b)=> normalizePrice(b.cijena || b.price) - normalizePrice(a.cijena || a.price));
    case "rating-desc":return items.slice().sort((a,b)=> getRatingFromBadges(b) - getRatingFromBadges(a));
    case "rating-asc": return items.slice().sort((a,b)=> getRatingFromBadges(a) - getRatingFromBadges(b));
    default: return items;
  }
}

function renderList(items) {
  const list = document.getElementById("product-list");
  list.innerHTML = "";
  document.getElementById("catalog-count").textContent = 
    `${currentBrand === "ALL" ? "Svi brendovi" : currentBrand} – ${currentCategory === "ALL" ? "sve kategorije" : currentCategory} – ${items.length} artikala`;

  items.forEach(prod => {
    const card = document.createElement("div");
    card.className = "product-card";

    const processedKeys = new Set(['slika_url', 'image', 'naziv', 'name', 'opis', 'tagline', 'description', 'cijena', 'price', 'link', 'specifications', 'features', 'badge-ovi', 'bedz', 'brend', 'id', 'categories']);
    let cardContent = '';

    const imageUrl = prod.slika_url || prod.image;
    cardContent += `<img src="${imageUrl || 'https://via.placeholder.com/300x200?text=Bez+slike'}" alt="Slika za ${prod.naziv || prod.name}">`;
    cardContent += `<h3>${prod.naziv || prod.name || 'Nepoznat naziv'}</h3>`;
    cardContent += `<p>${prod.opis || prod.tagline || prod.description || ''}</p>`;
    
    const price = prod.cijena || prod.price;
    const normalizedPrice = normalizePrice(price);
    cardContent += `<p><strong>Cijena:</strong> ${price ? (normalizedPrice > 0 ? normalizedPrice.toLocaleString('de-DE', { style: 'currency', currency: 'EUR' }) : price) : '-'}</p>`;

    if (prod.link) {
        const baseUrl = prod.link.startsWith('/') ? 'https://sonusart.ba' : '';
        cardContent += `<a href="${baseUrl}${prod.link}" target="_blank" rel="noopener noreferrer" class="link-button">Pogledaj proizvod</a>`;
    }

    const features = prod.features || prod['badge-ovi'] || prod['bedz'];
    if (features && features.length > 0) {
        cardContent += `<h4>Karakteristike</h4><ul class="features-list">`;
        features.forEach(feature => {
            if (typeof feature === 'object' && feature.title) {
                cardContent += `<li><strong>${feature.title}:</strong> ${feature.description}</li>`;
            } else {
                cardContent += `<li>${feature}</li>`;
            }
        });
        cardContent += `</ul>`;
    }

    if (prod.specifications && typeof prod.specifications === 'object') {
        cardContent += `<h4>Specifikacije</h4><dl class="specs-list">`;
        for (const specKey in prod.specifications) {
            cardContent += `<dt>${specKey}</dt><dd>${prod.specifications[specKey]}</dd>`;
        }
        cardContent += `</dl>`;
    }

    const otherDataContainer = document.createElement('div');
    let hasOtherData = false;
    let otherDataContent = '<dl class="specs-list">';
    for (const key in prod) {
        if (!processedKeys.has(key) && Object.hasOwnProperty.call(prod, key)) {
            hasOtherData = true;
            otherDataContent += `<dt>${key}</dt><dd>`;
            const value = prod[key];
            if (typeof value === 'object' && value !== null) {
                otherDataContent += `<pre>${JSON.stringify(value, null, 2)}</pre>`;
            } else {
                otherDataContent += `${value === null || value === undefined ? 'N/A' : value}`;
            }
            otherDataContent += `</dd>`;
        }
    }
    otherDataContent += '</dl>';

    if (hasOtherData) {
        cardContent += `<h4>Ostali podaci</h4>` + otherDataContent;
    }

    card.innerHTML = cardContent;
    list.appendChild(card);
  });
}

function applyFilters() {
  currentBrand = document.getElementById("brand-filter").value;
  const searchVal = document.getElementById("search").value.toLowerCase();
  const minPrice = parseFloat(document.getElementById("min-price").value) || 0;
  const maxPrice = parseFloat(document.getElementById("max-price").value) || Infinity;
  const feature = document.getElementById("feature-filter").value.trim().toLowerCase();
  const onlyPriced = document.getElementById("only-priced").checked;

  let items = sourceItems().filter(p => {
    const nameMatch = (p.naziv || p.name || "").toLowerCase().includes(searchVal);
    const priceVal = normalizePrice(p.cijena || p.price);
    const priceMatch = priceVal >= minPrice && priceVal <= maxPrice;
    const hasPrice = (p.cijena || p.price) && (p.cijena || p.price) !== "N/A";

    const allText = JSON.stringify(p).toLowerCase();
    const featureMatch = !feature || allText.includes(feature);

    return nameMatch && priceMatch && featureMatch && (!onlyPriced || hasPrice);
  });

  items = applySort(items);
  renderList(items);
}

document.getElementById("apply-btn").addEventListener("click", applyFilters);
document.getElementById("sort-select").addEventListener("change", applyFilters);
document.getElementById("feature-filter").addEventListener("change", applyFilters);
document.getElementById("only-priced").addEventListener("change", applyFilters);

document.getElementById("brand-filter").addEventListener("change", (e) => {
    currentBrand = e.target.value;
    currentCategory = "ALL";
    renderCategoriesForBrand(currentBrand);
    highlightActiveCategory();
    applyFilters();
});

["search", "min-price", "max-price"].forEach(id => {
  document.getElementById(id).addEventListener("keydown", e => { if (e.key === "Enter") applyFilters(); });
});
</script>

</body>
</html>
